<%= form_for @shipment do |f| %>
  <% if @shipment.errors.any? %>
    <div id="error_explanation">
      <h2>
        <%= pluralize(@shipment.errors.count, "error") %> prohibited
        this shipment from being saved:
      </h2>
      <ul>
        <% @shipment.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
 
 	<div class='table'>
 		<h2 class='sub-header'>Product</h2>
 		<table class='table table-striped'>
 			<tr>
 				<th>Product</th>
 				<th>Parcelshop id (if applicable)</th>
 				<th>Return service (if applicable)</th>
 				<th>Label action</th>
 			</tr>
 			<tr>
 				<td>
 					<%= f.bssel :product_id, options_from_collection_for_select(@current_user.products, :id, :name) %>
 				</td>
 				<td>
 					<%= f.bstxt_field :parcelshop_id %>
 				</td>
 				<td>
 					<%= f.bssel :return, {'No'=>0,'Yes'=>1}%>
 				</td>
 				<td>
 					<%= f.bssel :label_action, Shipment.label_action_options %>
 				</td>
 			</tr>
		</table>
		<table class='table table-striped'>
 			<tr>
 				<th>Remarks</th>
 				<th>Description</th>
 				<th>Reference</th>
 			</tr>
 			<tr>
 				<td>
 					<%= f.bstxt_field :remarks %>
 				</td>
 				<td>
 					<%= f.bstxt_field :description %>
 				</td>
 				<td>
 					<%= f.bstxt_field :reference %>
 				</td>
 			</tr>
 		</table>
	</div>
	<div class='table-responsive'>
		<h2 class='sub-header'>Packages</h2>
		<table class='table table-striped' id='package-table'>
			<tr>
				<th>Length (cm)</th>
				<th>Width (cm)</th>
				<th>Height (cm)</th>
				<th>Weight (kg)</th>
				<th>Amount</th>
			</tr>
			<% i_package = 0 %>
			<%= f.fields_for :packages do |fp| %>
			<% i_package += 1 %>
			<tr id='package-row-<%= i_package %>'>
				<td>
					<%= fp.bsnum_field :length %>
				</td>
				<td>
					<%= fp.bsnum_field :width %>
				</td>
				<td>
					<%= fp.bsnum_field :height %>
				</td>
				<td>
					<%= fp.bsnum_field :weight, :step => 'any' %>
				</td>
				<td>
					<%= fp.bsnum_field :amount %>
				</td>
			</tr>
			<% end %>
		<tfoot>
		<tr>
			<td></td>
			<td></td>
			<td></td>
			<td><button id='btn-remove-package' <%= 'disabled' if i_package < 2 %> onclick='removePackage()' type='button' class='btn btn-primary btn-block'>Remove</button></td>
			<td><button onclick='addPackage()' type='button' class='btn btn-primary btn-block'>Add</button></td>	
		</tr>
		</tfoot>
		</table>
	</div>



<%= render :partial => 'address_form', :locals => {:prefix => 'sender', :address => (form_address @shipment, 'sender')} %>
<%= render :partial => 'address_form', :locals => {:prefix => 'recipient', :address => (form_address @shipment, 'recipient')} %>




<button class="btn btn-lg btn-primary btn-block" type="submit">Submit</button>

<script type='text/javascript'>
	var nPackages = <%= i_package %>;
	function addPackage(){
		var baseRow = $('#package-row-1');
		nPackages++;
		var html = baseRow.html().replace(new RegExp('\\[0\\]', 'g'), '[' + nPackages + ']')
				.replace(new RegExp('_0_', 'g'), '_' + nPackages + '_');
		var newRow = document.createElement('tr')
		newRow.id = 'package-row-' + nPackages;
		newRow.innerHTML = html;
		$('#package-table').append(newRow);
		$('#btn-remove-package').prop('disabled', false);
	}
	
	function removePackage(){
		if(nPackages < 2){
			return;
		}
		var lastRow = $('#package-row-' + nPackages);
		lastRow.remove();
		nPackages--;
		if(nPackages < 2){
			$('#btn-remove-package').prop('disabled', true);
		}
	}
</script>

<% end %>


