<div class='shipment-show'>
  <h2 class='page-header'>Shipment #<%= @shipment.pretty_id %></h2>
  <% if @shipment.can_edit %>
  <%= link_to 'Edit', edit_shipment_path(@shipment) %>
  <br/>
  <% end %>
  <% if @shipment.can_submit %>
  <%= link_to 'Submit request', submit_shipment_path(@shipment), method: :post %> <br/>
  <% end %>

  <% if @shipment.status == 'failed' %>
  <div class='error'>
    <div class='title'>Error: <%= @shipment.api_response_error_msg %></div>
  </div>
  <% end %>
<div class='table-responsive'>
  <table class='table table-striped'>
    <tr>
      <th>ID</th>
      <th>Status</th>
      <th>Timestamp</th>
      <th>Product</th>
      <th>AWB</th>
      <th>Document</th>
      <th>Print status</th>
    </tr>
    <tr>
      <td>#<%= @shipment.pretty_id %></td>
      <td><%= @shipment.status.capitalize %></td>
      <% if @shipment.status == 'response_pending'%>
      <script type='text/javascript'>var autoReload = true;</script>
      <% end %>
      <td><%= @shipment.created_at %></td>
      <td><%= @shipment.product.product_code %></td>
      <td>
        <% if @shipment.can_print %>
        <%= link_to @shipment.awb, @shipment.tracking_url, :target => '_blank' %>
        <% else %>
        -
        <% end %>
      </td>
      <td>
        <% if @shipment.can_print %>
        <%= link_to "Download label", @shipment.document_url, :target => '_blank' %>
        <% else %>
        -
        <% end %>
      </td>
      <td>
        <% if @shipment.can_print %>
        	<% if @shipment.recent_label_pending? %>
        	Pending..
        	<script type='text/javascript'>var autoReload = true;</script>
        	<% else %>
    	 	<%= link_to 'Send to printer', reprint_shipment_path(@shipment), method: :post %>
        	<% end %>
        <% else %>
        -
        <% end %>
      </td>
    </tr>
  </table>
  <table class='table table-striped'>
  	<tr>
  		<th>Description</th>
  		<th>Reference</th>
  		<th>Parcelshop id</th>
  	</tr>
  	<tr>
  		<td><%= @shipment.description %></td>
  		<td><%= @shipment.reference %></td>
  		<td><%= @shipment.parcelshop_id %></td>
  	</tr>
  </table>
	<table class='table table-striped'>
  		<tr>
  			<th>Package:</th>
  			<th>Length</th>
  			<th>Width</th>
  			<th>Height</th>
  			<th>Weight</th>
  			<th>Amount</th>
  		</tr>
  		<tr>
			<td></td>
  			<td><%= @shipment.package_length %></td>
  			<td><%= @shipment.package_width %></td>
  			<td><%= @shipment.package_height %></td>
  			<td><%= @shipment.package_weight %></td>
  			<td><%= @shipment.amount %></td>
  		</tr>
	</table>

  
  
  <table  class='table table-striped'>
    <tr>
      <th>Sender</th>
      <th>Recipient</th>
    </tr>
    <tr/>
    <td>
    <%= render :partial => 'address_show', :locals => {:address => @shipment.sender } %>
    </td>
    <td>
    <%= render :partial => 'address_show', :locals => {:address => @shipment.recipient } %>
    </td>
   
  </table>
</div>
 
</div>

<script type='text/javascript'>
	if(autoReload === true){
		setInterval(
	    	function(){   
      			location.reload();
		     },5000 );
	}
</script>

